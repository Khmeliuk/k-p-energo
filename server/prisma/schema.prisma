
generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int     @id @default(autoincrement())
  name      String
  lastName  String
  email     String  @unique
  role      String  @default("user")
  department String
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean @default(false)
  @@index([email])

   tasks     Task[]     
  taskUpdates TaskUpdate[] 
  }

model Task {
  id              Int       @id @default(autoincrement())
  status          String    // enum: "виконується", "виконанно", "скасовано", "відкладенно"
  department      Int       // enum: 1, 2, 3, 4
  task            String    // JSON масив: ["Задача 1", "Задача 2", ...]
  address         String
  dateCreateTask  DateTime
  dateToEndTask   DateTime?
  description     String?   // JSON масив: ["опис 1", "опис 2", ...] або null
  ownerId         Int
  owner           User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  updates         TaskUpdate[]
  updatedAt       DateTime  @updatedAt

  @@index([ownerId])
  @@index([status])
  @@index([department])
}

model TaskUpdate {
  id          Int       @id @default(autoincrement())
  taskId      Int
  task        Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  ownerId     Int
  owner       User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  updateTime  DateTime  @default(now())
  patch       String    // JSON для зберігання змін
  
  @@index([taskId])
  @@index([ownerId])
}
